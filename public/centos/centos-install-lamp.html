<!DOCTYPE html>
<html lang="zh" class="h-100">
<head>
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Cache-Control" content="no-cache">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1, minimum-scale=1, maximum-scale=1">
<meta name="renderer" content="webkit">
<meta name="robots" content="index,follow">

<script src="../static/js/color-modes.js"></script>
<link rel="stylesheet" href="../static/css/style.css">
<link rel="icon" type="image/svg+xml" href="../static/images/favicon.png">

    <link rel="stylesheet" href="../static/css/dracula.css">
    <title>在CentOS上部署lamp环境 | 阿债的技术存档</title>
</head>
<body class="bg-body d-flex flex-column h-100">

<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
    <symbol id="arrow-right" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
    </symbol>
    <symbol id="circle-half" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
    </symbol>
    <symbol id="list" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
    </symbol>
    <symbol id="moon-stars-fill" viewBox="0 0 16 16">
        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
    </symbol>
    <symbol id="sun-fill" viewBox="0 0 16 16">
        <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
    </symbol>
    <symbol id="three-dots" viewBox="0 0 16 16">
        <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
    </symbol>
    <symbol id="github" viewBox="0 0 16 16">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
    </symbol>
</svg>

<nav class="navbar navbar-expand-lg fixed-top border-bottom theme-bg" data-bs-theme="dark">
    <div class="container">
      <button id="btn-sidebar" class="navbar-toggler p-2 me-1" type="button" data-bs-toggle="offcanvas" data-bs-target="#ft-guide-chapters" aria-controls="ft-guide-chapters" aria-label="边栏">
            <svg class="bi"><use href="#list"></use></svg>
            <span class="d-none fs-6 pe-1">查看</span>
        </button>
        <a class="navbar-brand" href="../index.html" aria-label="回首页"><img src="../static/images/logo.svg" alt="" width="30" height="24">阿债的技术存档</a>
        <button class="ms-auto navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#ft-offcanvas-navbar" aria-controls="ft-offcanvas-navbar" aria-label="导航">
            <svg class="bi"><use href="#three-dots"></use></svg>
        </button>
        <div class="offcanvas offcanvas-end" tabindex="-1" id="ft-offcanvas-navbar" aria-labelledby="ft-offcanvas-navbar-label">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="ft-offcanvas-navbar-label">阿债的技术存档</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="关闭"></button>
            </div>
            <div class="offcanvas-body">

                <ul id="site-channels" class="navbar-nav flex-grow-1 pe-3">
                    <li class="nav-item">
                        <a class="nav-link active" href="../index.html">博客</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../pages/help.html">帮助</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../pages/about.html">关于</a>
                    </li>
                </ul>

                <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/azhai" target="_blank" aria-label="GitHub">
                            <svg class="bi"><use href="#github"></use></svg><span class="d-lg-none ms-2">GitHub</span>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <button class="btn btn-link nav-link py-2 px-0 px-lg-2 dropdown-toggle d-flex align-items-center"
                                id="ft-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="主题">
                            <svg class="bi my-1 theme-icon-active"><use href="#moon-stars-fill"></use></svg>
                            <span class="d-lg-none ms-2" id="ft-theme-text">切换主题</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-xxl-start">
                            <li>
                                <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <svg class="bi me-2"><use href="#sun-fill"></use></svg>浅色主题
                                </button>
                            </li>
                            <li>
                                <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <svg class="bi me-2"><use href="#moon-stars-fill"></use></svg>深色主题
                                </button>
                            </li>
                            <li>
                                <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                                    <svg class="bi me-2"><use href="#circle-half"></use></svg>跟随浏览器
                                </button>
                            </li>
                        </ul>
                    </li>
                </ul>

            </div>
        </div>
    </div>
</nav>


<main>
    <div class="container">
        <div class="row">

            <div class="offcanvas offcanvas-start" tabindex="-1" id="ft-guide-chapters" aria-labelledby="ft-guide-chapters-label" data-bs-theme="dark">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title" id="ft-guide-chapters-label">边栏</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#ft-guide-chapters"></button>
    </div>

    <div class="offcanvas-body">
        <nav class="w-100 guide-chapters" aria-label="文章列表">

<ul class="mb-0 pb-3 pb-md-2 pe-lg-2 text-body-secondary">
    
    <li>
        <strong class="d-flex w-100 align-items-center fw-semibold">centos</strong>
        <ul class="fw-normal pb-2 small">
            
            <li><a href="../centos/centos-install-lamp.html" class="art-link" title="2013-05-21">在CentOS上部署lamp环境</a></li>
            
            <li><a href="../centos/centos-install-leveldb-beanstalkd.html" class="art-link" title="2013-03-08">安装Linux开发环境之五 —— LevelDB、Beanstalkd</a></li>
            
            <li><a href="../centos/centos-install-mysql.html" class="art-link" title="2013-02-20">安装Linux开发环境之一 —— MySQL</a></li>
            
            <li><a href="../centos/centos-install-nginx.html" class="art-link" title="2013-02-20">安装Linux开发环境之三 —— Nginx</a></li>
            
            <li><a href="../centos/centos-install-php.html" class="art-link" title="2013-02-20">安装Linux开发环境之二 —— PHP</a></li>
            
            <li><a href="../centos/centos-install-redis.html" class="art-link" title="2013-02-20">安装Linux开发环境之四 —— Redis</a></li>
            
        </ul>
    </li>
    
    <li>
        <strong class="d-flex w-100 align-items-center fw-semibold">deploy</strong>
        <ul class="fw-normal pb-2 small">
            
            <li><a href="../deploy/install-postfix.html" class="art-link" title="2013-04-16">安装Postfix邮件服务器</a></li>
            
            <li><a href="../deploy/linux-upstart.html" class="art-link" title="2013-04-24">Linux新的守护进程方式upstart</a></li>
            
            <li><a href="../deploy/nginx-http-base-auth.html" class="art-link" title="2013-04-24">Nginx设置简单HTTP认证</a></li>
            
            <li><a href="../deploy/nginx-case-insensitive.html" class="art-link" title="2013-04-12">让Nginx对URL不区分大小写</a></li>
            
            <li><a href="../deploy/nginx-log-cookie.html" class="art-link" title="2013-04-23">Nginx记录访问cookie到日志</a></li>
            
            <li><a href="../deploy/nginx-logrotate.html" class="art-link" title="2013-06-09">Nginx日志按日期切割</a></li>
            
            <li><a href="../deploy/rsync-config.html" class="art-link" title="2013-04-12">Rsync配置与使用</a></li>
            
            <li><a href="../deploy/samba-conf.html" class="art-link" title="2013-07-08">Samba简单配置</a></li>
            
            <li><a href="../deploy/vim-config.html" class="art-link" title="2013-04-11">VIM配置</a></li>
            
        </ul>
    </li>
    
    <li>
        <strong class="d-flex w-100 align-items-center fw-semibold">php</strong>
        <ul class="fw-normal pb-2 small">
            
            <li><a href="../php/calc-24-points.html" class="art-link" title="2016-03-24">四则运算计算24点</a></li>
            
            <li><a href="../php/last-month-day.html" class="art-link" title="2016-03-24">找出上个月的这一天</a></li>
            
            <li><a href="../php/phpunit-boot.html" class="art-link" title="2014-04-10">启动PHPUnit测试的简便方式</a></li>
            
            <li><a href="../php/weight-rrd.html" class="art-link" title="2014-01-18">PHP权重轮询</a></li>
            
            <li><a href="../php/zf2-multiple-dbs.html" class="art-link" title="2013-03-21">Zend Framework 2 配置多个数据库</a></li>
            
        </ul>
    </li>
    
    <li>
        <strong class="d-flex w-100 align-items-center fw-semibold">python</strong>
        <ul class="fw-normal pb-2 small">
            
            <li><a href="../python/python-activestate-code.html" class="art-link" title="2016-03-25">ActiveState上一些Python优秀代码</a></li>
            
            <li><a href="../python/python-functions.html" class="art-link" title="2013-07-08">收集用过的一些Python方法</a></li>
            
            <li><a href="../python/python-gists.html" class="art-link" title="2016-03-24">Gist上一些Python的算法题</a></li>
            
            <li><a href="../python/python-md5.html" class="art-link" title="2012-05-15">Python计算文件的MD5</a></li>
            
            <li><a href="../python/python-mulpti-logging.html" class="art-link" title="2012-05-15">Python多进程记录日志</a></li>
            
            <li><a href="../python/python-paginate.html" class="art-link" title="2012-05-16">一个Python分页</a></li>
            
            <li><a href="../python/python-pinyin.html" class="art-link" title="2012-03-31">GB2312中文转拼音</a></li>
            
            <li><a href="../python/python-pop3.html" class="art-link" title="2012-03-04">通过POP3协议读取指定邮件</a></li>
            
            <li><a href="../python/python-pymssql-re2.html" class="art-link" title="2013-04-28">安装Python支持SqlServer和re2</a></li>
            
            <li><a href="../python/python-urlib.html" class="art-link" title="2012-05-16">Python网址操作函数</a></li>
            
        </ul>
    </li>
    
    <li>
        <strong class="d-flex w-100 align-items-center fw-semibold">tool</strong>
        <ul class="fw-normal pb-2 small">
            
            <li><a href="../tool/git-push.html" class="art-link" title="2012-05-15">正确使用git避免提交冲突</a></li>
            
            <li><a href="../tool/haskell-mysql-dumper.html" class="art-link" title="2015-05-20">MySQL导出CSV文件（Haskell实现）</a></li>
            
        </ul>
    </li>
    
</ul>

        </nav>
    </div>
</div>


            <aside class="d-none d-lg-block me-xxl-5 col-auto">
    <nav class="w-100 guide-chapters" aria-label="文章列表">

        <ul id="article-nav" class="sidebar-nav mb-0 pb-3 pb-md-2 pe-lg-2 text-body-secondary">
            
            <li>
                <strong class="d-flex w-100 align-items-center fw-semibold">centos</strong>
                <ul class="fw-normal pb-2 small">
                    
                    <li><a href="../centos/centos-install-lamp.html" class="art-link" title="2013-05-21">在CentOS上部署lamp环境</a></li>
                    
                    <li><a href="../centos/centos-install-leveldb-beanstalkd.html" class="art-link" title="2013-03-08">安装Linux开发环境之五 —— LevelDB、Beanstalkd</a></li>
                    
                    <li><a href="../centos/centos-install-mysql.html" class="art-link" title="2013-02-20">安装Linux开发环境之一 —— MySQL</a></li>
                    
                    <li><a href="../centos/centos-install-nginx.html" class="art-link" title="2013-02-20">安装Linux开发环境之三 —— Nginx</a></li>
                    
                    <li><a href="../centos/centos-install-php.html" class="art-link" title="2013-02-20">安装Linux开发环境之二 —— PHP</a></li>
                    
                    <li><a href="../centos/centos-install-redis.html" class="art-link" title="2013-02-20">安装Linux开发环境之四 —— Redis</a></li>
                    
                </ul>
            </li>
            
            <li>
                <strong class="d-flex w-100 align-items-center fw-semibold">deploy</strong>
                <ul class="fw-normal pb-2 small">
                    
                    <li><a href="../deploy/install-postfix.html" class="art-link" title="2013-04-16">安装Postfix邮件服务器</a></li>
                    
                    <li><a href="../deploy/linux-upstart.html" class="art-link" title="2013-04-24">Linux新的守护进程方式upstart</a></li>
                    
                    <li><a href="../deploy/nginx-http-base-auth.html" class="art-link" title="2013-04-24">Nginx设置简单HTTP认证</a></li>
                    
                    <li><a href="../deploy/nginx-case-insensitive.html" class="art-link" title="2013-04-12">让Nginx对URL不区分大小写</a></li>
                    
                    <li><a href="../deploy/nginx-log-cookie.html" class="art-link" title="2013-04-23">Nginx记录访问cookie到日志</a></li>
                    
                    <li><a href="../deploy/nginx-logrotate.html" class="art-link" title="2013-06-09">Nginx日志按日期切割</a></li>
                    
                    <li><a href="../deploy/rsync-config.html" class="art-link" title="2013-04-12">Rsync配置与使用</a></li>
                    
                    <li><a href="../deploy/samba-conf.html" class="art-link" title="2013-07-08">Samba简单配置</a></li>
                    
                    <li><a href="../deploy/vim-config.html" class="art-link" title="2013-04-11">VIM配置</a></li>
                    
                </ul>
            </li>
            
            <li>
                <strong class="d-flex w-100 align-items-center fw-semibold">php</strong>
                <ul class="fw-normal pb-2 small">
                    
                    <li><a href="../php/calc-24-points.html" class="art-link" title="2016-03-24">四则运算计算24点</a></li>
                    
                    <li><a href="../php/last-month-day.html" class="art-link" title="2016-03-24">找出上个月的这一天</a></li>
                    
                    <li><a href="../php/phpunit-boot.html" class="art-link" title="2014-04-10">启动PHPUnit测试的简便方式</a></li>
                    
                    <li><a href="../php/weight-rrd.html" class="art-link" title="2014-01-18">PHP权重轮询</a></li>
                    
                    <li><a href="../php/zf2-multiple-dbs.html" class="art-link" title="2013-03-21">Zend Framework 2 配置多个数据库</a></li>
                    
                </ul>
            </li>
            
            <li>
                <strong class="d-flex w-100 align-items-center fw-semibold">python</strong>
                <ul class="fw-normal pb-2 small">
                    
                    <li><a href="../python/python-activestate-code.html" class="art-link" title="2016-03-25">ActiveState上一些Python优秀代码</a></li>
                    
                    <li><a href="../python/python-functions.html" class="art-link" title="2013-07-08">收集用过的一些Python方法</a></li>
                    
                    <li><a href="../python/python-gists.html" class="art-link" title="2016-03-24">Gist上一些Python的算法题</a></li>
                    
                    <li><a href="../python/python-md5.html" class="art-link" title="2012-05-15">Python计算文件的MD5</a></li>
                    
                    <li><a href="../python/python-mulpti-logging.html" class="art-link" title="2012-05-15">Python多进程记录日志</a></li>
                    
                    <li><a href="../python/python-paginate.html" class="art-link" title="2012-05-16">一个Python分页</a></li>
                    
                    <li><a href="../python/python-pinyin.html" class="art-link" title="2012-03-31">GB2312中文转拼音</a></li>
                    
                    <li><a href="../python/python-pop3.html" class="art-link" title="2012-03-04">通过POP3协议读取指定邮件</a></li>
                    
                    <li><a href="../python/python-pymssql-re2.html" class="art-link" title="2013-04-28">安装Python支持SqlServer和re2</a></li>
                    
                    <li><a href="../python/python-urlib.html" class="art-link" title="2012-05-16">Python网址操作函数</a></li>
                    
                </ul>
            </li>
            
            <li>
                <strong class="d-flex w-100 align-items-center fw-semibold">tool</strong>
                <ul class="fw-normal pb-2 small">
                    
                    <li><a href="../tool/git-push.html" class="art-link" title="2012-05-15">正确使用git避免提交冲突</a></li>
                    
                    <li><a href="../tool/haskell-mysql-dumper.html" class="art-link" title="2015-05-20">MySQL导出CSV文件（Haskell实现）</a></li>
                    
                </ul>
            </li>
            
        </ul>

    </nav>
</aside>


            
            <div class="col-12 col-lg-auto order-lg-last ft-toc sticky-sidebar mt-1 ms-xxl-5 px-sm-1 text-body-secondary">
                <button class="btn btn-secondary d-lg-none collapsed ft-page-toc-toggle" type="button"
                        data-bs-toggle="collapse" data-bs-target="#ft-toc-nav" aria-expanded="false"
                        aria-controls="ft-toc-nav">
                    大纲
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                         class="bi bi-chevron-expand" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                              d="M3.646 9.146a.5.5 0 0 1 .708 0L8 12.793l3.646-3.647a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 0-.708m0-2.292a.5.5 0 0 0 .708 0L8 3.207l3.646 3.647a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 0 0 0 .708"></path>
                    </svg>
                </button>
                <strong class="d-none d-lg-block h6 my-2 ms-2">大纲</strong>
                <hr class="d-none d-lg-block my-2">
                <div class="collapse" id="ft-toc-nav">
                    <nav id="page-toc">
                        <ul>
<li>
<a href="#heading">描述</a><ul>
<li>
<a href="#deploy-lampsh">脚本deploy_lamp.sh</a></li>
<li>
<a href="#libtrapsh">脚本lib.trap.sh</a></li>
</ul>
</li>
</ul>

                    </nav>
                </div>
            </div>
            

            <div class="col ft-guide mt-3 px-lg-3 px-xl-5" data-bs-spy="scroll" data-bs-target="#page-toc"
                 data-bs-offset="0" tabindex="0">
                <h1 class="post-title">在CentOS上部署lamp环境</h1>

                <div class="post-meta">
                    <div>
                        
                        作者 <img width="32" height="32" alt=""
                                  class="post-avatar" src="../static/avatars/ryan.jpg"/>
                        <span class="post-author">Ryan Liu</span>
                        
                        发表于 <span class="post-date">2013-05-21</span>
                    </div>
                    
                    <div>标签 
                        <span class="tags">
                            <a class="post-tag" href="../tags/linux.html">linux</a>
                        
                            <a class="post-tag" href="../tags/mysql.html">mysql</a>
                        
                            <a class="post-tag" href="../tags/php.html">php</a>
                        
                            <a class="post-tag" href="../tags/nginx.html">nginx</a>
                        </span>
                    </div>
                    
                </div>

                <div class="post-body">
                    
<h2 id="heading">描述</h2>
<p>这里的lamp中web server用的是nginx而不是apache，但还是用传统的叫法lamp。<br />
环境 CentOS 6.4，我的是64位，但在32位上依然可用。</p>
<p>从<a href="http://stackoverflow.com/questions/64786/error-handling-in-bash">StackOverflow</a>下载一个调试bash的脚本lib.trap.sh，<br />
我把它放在本文最后。</p>
<p>使用的版本如下：</p>
<ul>
<li>mysql 5.6.11</li>
<li>php 5.4.14</li>
<li>nginx 1.4.1</li>
</ul>
<h3 id="deploy-lampsh">脚本deploy_lamp.sh</h3>
<pre><code class="language-bash">source &quot;lib.trap.sh&quot;

username=&quot;ryan&quot;
if [[ -z &quot;$username&quot; ]]; then
    username=`whoami` #当前用户名
fi
cpu_cores=`cat /proc/cpuinfo | gawk '/cpu cores/{n+=1} END{print n}'` #CPU内核数
if [[ `uname -m` =~ &quot;x86_64&quot; ]]; then
    sys64bit=&quot;True&quot; #64位系统
else
    sys64bit=&quot;&quot;
fi
if [[ `id -un mysql` != &quot;mysql&quot; ]]; then
    groupadd -f mysql
    useradd -r -g mysql mysql
fi

yum install -y gcc gcc-c++ make cmake automake autoconf binutils
yum install -y gawk sed vim wget
yum install -y git httpd-tools
yum install -y zlib-devel ncurses-devel readline-devel
yum install -y bzip2-devel gmp-devel openssl-devel curl-devel freetype-devel
yum install -y libxml2-devel libpng-devel libjpeg-devel libicu-devel libc-client-devel
yum install -y libtool libtool-ltdl-devel


function download()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    if [ ! -d &quot;ngx_http_lower_upper_case&quot; ]; then
        git clone https://github.com/replay/ngx_http_lower_upper_case.git
    fi
    if [ ! -f &quot;pcre-8.32.tar.gz&quot; ]; then
        wget http://sourceforge.net/projects/pcre/files/pcre/8.32/pcre-8.32.tar.gz
    fi
    if [ ! -f &quot;nginx-1.4.1.tar.gz&quot; ]; then
        wget http://nginx.org/download/nginx-1.4.1.tar.gz
    fi
    if [ ! -f &quot;freetds-stable.tgz&quot; ]; then
        wget ftp://ftp.astron.com/pub/freetds/stable/freetds-stable.tgz
    fi
    if [ ! -f &quot;libmcrypt-2.5.8.tar.gz&quot; ]; then
        wget -O libmcrypt-2.5.8.tar.gz http://downloads.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz?use_mirror=nchc
    fi
    if [ ! -f &quot;php-5.4.14.tar.gz&quot; ]; then
        wget -O php-5.4.14.tar.gz http://cn2.php.net/get/php-5.4.14.tar.gz/from/this/mirror
    fi
    if [ ! -f &quot;mysql-5.6.11.tar.gz&quot; ]; then
        wget http://cdn.mysql.com/Downloads/MySQL-5.6/mysql-5.6.11.tar.gz
    fi
}


function ins_mysql()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    rm -rf mysql-5.6.11
    tar xzf mysql-5.6.11.tar.gz
    cd mysql-5.6.11
    #安装全部字符集请使用 -DEXTRAT_CHARSETS=all
    #ENABLED_LOCAL_INFILE选项为“允许从本地导入数据”
    cmake . \
        -DCMAKE_INSTALL_PREFIX=/opt/mysql-5.6.11 \
        -DINSTALL_DATADIR=/opt/mysql-5.6.11/data \
        -DDEFAULT_CHARSET=utf8 \
        -DDEFAULT_COLLATION=utf8_general_ci \
        -DEXTRAT_CHARSETS=latin1,gbk \
        -DENABLED_LOCAL_INFILE=1
    make &amp;&amp; make install
    #大于半小时的漫长等待中......
    cd ..
}

function ini_mysql()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    #必要的软连接和目录
    ln -sf /opt/mysql-5.6.11/bin/mysqld_safe /usr/bin/mysqld_safe
    ln -sf /opt/mysql-5.6.11/bin/mysql /usr/bin/mysql
    ln -sf /opt/mysql-5.6.11/bin/mysqldump /usr/bin/mysqldump
    ln -sf /opt/mysql-5.6.11/bin/mysqlimport /usr/bin/mysqlimport
    ln -sf /opt/mysql-5.6.11/bin/mysql_config /usr/bin/mysql_config
    mkdir -p /var/run/mysqld
    chmod -R 777 /var/run/mysqld
    chown -R mysql:mysql /opt/mysql-5.6.11/data/

    #初始化MySQL
    /opt/mysql-5.6.11/scripts/mysql_install_db --user=mysql --basedir=/opt/mysql-5.6.11 --datadir=/opt/mysql-5.6.11/data
    #64位Linux
    if [ -n &quot;$sys64bit&quot; ]; then
      ln -sf /opt/mysql-5.6.11/lib  /opt/mysql-5.6.11/lib64
    fi
    #设置配置文件
    if [ ! -f /opt/mysql-5.6.11/my.cnf ]; then
        cp /opt/mysql-5.6.11/support-files/my-default.cnf /opt/mysql-5.6.11/my.cnf
    fi
    rm -f /etc/my.cnf
    sed -i '/# basedir =/cbasedir = \/opt\/mysql-5.6.11' /opt/mysql-5.6.11/my.cnf
    sed -i '/# datadir =/cdatadir = \/opt\/mysql-5.6.11\/data' /opt/mysql-5.6.11/my.cnf
    sed -i '/# port =/cport = 3306' /opt/mysql-5.6.11/my.cnf
    #sed -i '/# innodb_buffer_pool_size = 128M/cinnodb_buffer_pool_size = 256M' /opt/mysql-5.6.11/my.cnf
    sed -i '$alog-error=/var/log/mysqld.log' /opt/mysql-5.6.11/my.cnf
    sed -i '$apid-file=/var/run/mysqld/mysqld.pid' /opt/mysql-5.6.11/my.cnf
    sed -i '$G' /opt/mysql-5.6.11/my.cnf
    sed -i '$a[mysqld_safe]' /opt/mysql-5.6.11/my.cnf
    sed -i '$alog-error=/var/log/mysqld.log' /opt/mysql-5.6.11/my.cnf
    sed -i '$apid-file=/var/run/mysqld/mysqld.pid' /opt/mysql-5.6.11/my.cnf
    ln -sf /opt/mysql-5.6.11/my.cnf /etc/my.cnf

    #设置系统服务
    rm -f /etc/init.d/mysql
    cp /opt/mysql-5.6.11/support-files/mysql.server /etc/init.d/mysql
    sed -i '/^basedir=/cbasedir=\/opt\/mysql-5.6.11' /etc/init.d/mysql
    sed -i '/^datadir=/cdatadir=\/opt\/mysql-5.6.11\/data' /etc/init.d/mysql
    #重启mysql服务
    /etc/init.d/mysql start
}


function ini_mysql_user()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;

    #或者使用/opt/mysql-5.6.11/bin/mysql_secure_installation
    local rootpass=toor
    local dbapass=changeme
    mysql -u root --password=&quot;&quot; mysql &lt;&lt; EOD
    DELETE FROM \`user\` WHERE User='';
    DELETE FROM \`db\` WHERE User='';
    SET PASSWORD FOR 'root'@'localhost'=PASSWORD('$rootpass');
    SET PASSWORD FOR 'root'@'127.0.0.1'=PASSWORD('$rootpass');
    SET PASSWORD FOR 'root'@'::1'=PASSWORD('$rootpass');
    SET PASSWORD FOR 'root'@'`hostname`'=PASSWORD('$rootpass');
    GRANT ALL PRIVILEGES ON \`db\\_%\`.* TO 'dba'@'localhost' IDENTIFIED BY '$dbapass' WITH GRANT OPTION;
    GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,ALTER,INDEX ON \`db\\_%\`.* TO 'dba'@'192.168.0.%' IDENTIFIED BY '$dbapass' WITH GRANT OPTION;
    FLUSH PRIVILEGES;
    UPDATE user SET File_priv='Y' WHERE User='dba';
    FLUSH PRIVILEGES;
    GRANT FILE ON *.* TO 'dba'@'localhost';
    GRANT FILE ON *.* TO 'dba'@'192.168.0.%';
    FLUSH PRIVILEGES;
EOD

    #手工停止
    /opt/mysql-5.6.11/bin/mysqladmin --password=&quot;$rootpass&quot; shutdown
    /etc/init.d/mysql start
    #更新
    /opt/mysql-5.6.11/bin/mysql_upgrade --password=&quot;$rootpass&quot;
    #手工启动
    #mysqld_safe --user=mysql &amp;
    /etc/init.d/mysql restart
}


function ins_php_pre()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    rm -rf freetds-0.91
    rm -rf libmcrypt-2.5.8

    if [ ! -d &quot;/opt/freetds-0.91&quot; ]; then
        tar xzf freetds-stable.tgz
        cd freetds-0.91
        ./configure --prefix=/opt/freetds-0.91 --with-tdsver=8.0 --enable-msdblib
        make &amp;&amp; make install
        cd ..
        #64位系统下（CentOS 6.3有这个问题，其他发行版不知道是不是也这样），还需要
        if [ -n &quot;$sys64bit&quot; ]; then
            ln -sf /opt/freetds-0.91/lib /opt/freetds-0.91/lib64
        fi
    fi

    if [ ! -e &quot;/usr/local/lib/libmcrypt.so.4&quot; ]; then
        tar xzf libmcrypt-2.5.8.tar.gz
        cd libmcrypt-2.5.8
        ./configure
        make &amp;&amp; make install
        cd ..
        if [ -n &quot;$sys64bit&quot; ]; then
            ln -sf /usr/local/lib/libmcrypt.so.4.4.8 /usr/lib64/libmcrypt.so.4
        else
            ln -sf /usr/local/lib/libmcrypt.so.4.4.8 /usr/lib/libmcrypt.so.4
        fi
    fi
}


function ins_php()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    rm -rf php-5.4.14

    #如果configure报错Note that the MySQL client library is not bundled anymore.
    #请将/opt/mysql-5.6.11/lib 建立软连接 /opt/mysql-5.6.11/lib64
    #64位Linux
    if [ -n &quot;$sys64bit&quot; ]; then
        ln -sf /opt/mysql-5.6.11/lib /opt/mysql-5.6.11/lib64
        gnu_x86_64=&quot;--build=x86_64-redhat-linux-gnu --host=x86_64-redhat-linux-gnu --with-libdir=lib64&quot;
    else
        gnu_x86_64=&quot;&quot;
    fi

    tar xzf php-5.4.14.tar.gz
    cd php-5.4.14
    #注意：$gnu_x86_64两边不要加引号或双引号
    ./configure --prefix=/opt/php-5.4.14 \
    --with-mysql=/opt/mysql-5.6.11 --with-mysqli=/opt/mysql-5.6.11/bin/mysql_config \
    --with-pdo-mysql=/opt/mysql-5.6.11 --with-mysql-sock=/tmp/mysql.sock \
    --with-mcrypt=/usr/local --with-zlib \
    --with-pic --with-curl=shared --with-freetype-dir --with-png-dir \
    --with-gettext=shared --with-gmp=shared --with-iconv --with-jpeg-dir --with-png-dir \
    --with-openssl --with-libxml-dir --with-pcre-regex \
    --with-kerberos --with-imap --with-imap-ssl \
    --with-pear --with-gd --enable-gd-native-ttf --enable-calendar=shared \
    --enable-exif --enable-ftp --enable-sockets --enable-bcmath=shared \
    --enable-pcntl --enable-intl --enable-mbstring \
    --enable-zip --with-bz2=shared \
    --enable-sysvsem --enable-sysvshm --enable-sysvmsg \
    --without-unixODBC --enable-mbregex --enable-embed \
    --enable-tokenizer --disable-phar --with-sqlite3 \
    --enable-fpm --with-fpm-user=&quot;$username&quot; --with-fpm-group=&quot;$username&quot; \
    --with-layout=GNU --with-mssql=/opt/freetds-0.91 $gnu_x86_64
    make &amp;&amp; make install
    cd ..
}


function ini_php()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    #建立软连接
    rm -rf /usr/sbin/php-fpm
    rm -rf /usr/bin/pear
    rm -rf /usr/bin/pecl
    rm -rf /usr/bin/php*
    ln -s /opt/php-5.4.14/bin/php /usr/bin/php
    ln -s /opt/php-5.4.14/bin/phpize /usr/bin/phpize
    ln -s /opt/php-5.4.14/bin/pear /usr/bin/pear
    ln -s /opt/php-5.4.14/bin/pecl /usr/bin/pecl
    ln -s /opt/php-5.4.14/bin/php-config /usr/bin/php-config
    ln -s /opt/php-5.4.14/sbin/php-fpm /usr/sbin/php-fpm
    #配置文件
    mkdir -p /var/run/php-fpm/
    cp php-5.4.14/php.ini-production /opt/php-5.4.14/etc/php.ini
    cp /opt/php-5.4.14/etc/php-fpm.conf.default /opt/php-5.4.14/etc/php-fpm.conf

    #修改配置
    sed -i '/^max_execution_time/cmax_execution_time = 600' /opt/php-5.4.14/etc/php.ini
    sed -i '/^error_reporting/cerror_reporting = E_ALL &amp; ~E_DEPRECATED &amp; ~E_NOTICE' /opt/php-5.4.14/etc/php.ini
    sed -i '/^display_errors/cdisplay_errors = On' /opt/php-5.4.14/etc/php.ini
    sed -i '/^display_startup_errors/cdisplay_startup_errors = On' /opt/php-5.4.14/etc/php.ini
    sed -i '/^track_errors/ctrack_errors = On' /opt/php-5.4.14/etc/php.ini
    sed -i '/^upload_max_filesize/cupload_max_filesize = 20M' /opt/php-5.4.14/etc/php.ini
    sed -i '/^;date.timezone/cdate.timezone = Asia/Shanghai' /opt/php-5.4.14/etc/php.ini

    #修改php-fpm的进程数
    sed -i &quot;/^;daemonize/cdaemonize = yes&quot; /opt/php-5.4.14/etc/php-fpm.conf
    sed -i &quot;/^listen = /clisten = /var/run/php-fpm/php-fpm.sock&quot; /opt/php-5.4.14/etc/php-fpm.conf
    sed -i '/^pm.max_children/cpm.max_children = 30' /opt/php-5.4.14/etc/php-fpm.conf
    sed -i '/^pm.start_servers/cpm.start_servers = 2' /opt/php-5.4.14/etc/php-fpm.conf
    sed -i '/^pm.min_spare_servers/cpm.min_spare_servers = 2' /opt/php-5.4.14/etc/php-fpm.conf
    sed -i '/^pm.max_spare_servers/cpm.max_spare_servers = 30' /opt/php-5.4.14/etc/php-fpm.conf

    mkdir -p /etc/php5/fpm/
    ln -s /opt/php-5.4.14/etc/php.ini /etc/php5/fpm/php.ini
    ln -s /opt/php-5.4.14/etc/php-fpm.conf /etc/php5/fpm/php-fpm.conf
}


function ins_php_ext()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    #添加常用扩展
    if [ ! -f &quot;/opt/php-5.4.14/lib/php/20100525/apc.so&quot; ]; then
        printf &quot;\n&quot; | pecl install apc
        sed -i '1aextension=apc.so' /opt/php-5.4.14/etc/php.ini
    fi
    if [ ! -f &quot;/opt/php-5.4.14/lib/php/20100525/xdebug.so&quot; ]; then
        pecl install xdebug
        #ThreadSafe版本，带有_ts
        sed -i '1azend_extension_ts=xdebug.so' /opt/php-5.4.14/etc/php.ini
    fi
    if [ ! -d &quot;/opt/php-5.4.14/share/pear/PHPUnit&quot; ]; then
        pear upgrade pear &amp;&amp; pear install phpunit
    fi
    if [ ! -f &quot;/opt/php-5.4.14/bin/phing&quot; ]; then
        pear channel-discover pear.phing.info
        pear install phing/phing
        ln -sf /opt/php-5.4.14/bin/phing /usr/bin/phing
    fi
}


function ins_nginx()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    rm -rf pcre-8.32
    rm -rf nginx-1.4.1
    tar xzf pcre-8.32.tar.gz
    tar xzf nginx-1.4.1.tar.gz
    cd nginx-1.4.1
    ./configure --prefix=/opt/nginx-1.4.1 --with-pcre=../pcre-8.32 --add-module=../ngx_http_lower_upper_case
    make &amp;&amp; make install
    cd ..
}


function ini_nginx()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    cd /opt/nginx-1.4.1/conf/
    #替换主配置
    sed -i &quot;/^#user/cuser  $username;&quot; nginx.conf
    sed -i &quot;/^worker_processes/cworker_processes  $cpu_cores;&quot; nginx.conf
    sed -i &quot;s/^#pid/pid/&quot; nginx.conf
    sed -i &quot;/^[[:space:]]*#log_format/{N;N;s/\([[:space:]]*\)#/\1/g;h;s/main/sess/;s/'\;$/ \&quot;\$var_sessid\&quot;'\;/;G}&quot; nginx.conf
    sed -i '/^[[:space:]]*#gzip/c\    gzip  on;\n    gzip_min_length  1k;' nginx.conf
    sed -i '/^[[:space:]]* server {/,$d' nginx.conf
    sed -i '$a\    include sites/*.conf;\n}' nginx.conf
    #增加一个PHP配置
    mkdir sites authes
    touch sites/test.conf
    #将最后面的site配置文件写入上面的文件
    chmod -R 777 sites
    cd -

    ln -sf /opt/nginx-1.4.1/sbin/nginx /usr/sbin/nginx
}


function ini_nginx_site()
{
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;$FUNCNAME start ......&quot;
    cat &gt; /opt/nginx-1.4.1/conf/sites/template.conf.bak &lt;&lt; EOD
server {
    listen           80;
    server_name      test.example.com;
    charset          utf-8;
    root             /home/ryan/projects/test;

    # case insensitive
    #lower \$lower_uri &quot;\$uri&quot;;
    #try_files \$uri \$lower_uri;

    set \$var_sessid &quot;-&quot;;
    if ( \$http_cookie ~* &quot;PHPSESSID=(\S+)(;.*|\$)&quot;)
    {
        set \$var_sessid \$1;
    }
    access_log  logs/test.access.log  main;

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    #error_page   500 502 503 504  /50x.html;
    #location = /50x.html {
    #    root   html;
    #}

    if (\$request_uri ~* ^.*\\.(svn|git|hg|bzr|cvs).*\$) {
        return 404;
    }

    location ~* ^.+\\.(css|js|jpg|png|gif|ico|swf|pdf|txt|xlsx)\$ {
        access_log off;
        expires    30d;
    }

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    location / {
        #auth_basic            &quot;Restricted&quot;;
        #auth_basic_user_file  authes/test;
        try_files \$uri  \$uri/  /index.php?\$query_string;
        #fastcgi_pass   127.0.0.1:9000;
        fastcgi_pass    unix:/var/run/php-fpm/php-fpm.sock;
        fastcgi_index   index.php;
        include         fastcgi_params;
        fastcgi_param   SCRIPT_FILENAME  \$document_root\$fastcgi_script_name;
    }

    #location ~* /\$ {
    #    index    index.html;
    #}
}
EOD
    chkconfig mysql on
}


softdir=&quot;/home/$username/soft/&quot;
mkdir -p $softdir
cd $softdir
download
[ -d &quot;/opt/mysql-5.6.11&quot; ] || { ins_mysql; ini_mysql; ini_mysql_user; }
[ -d &quot;/opt/php-5.4.14&quot; ] || { ins_php_pre; ins_php; ini_php; ins_php_ext; }
[ -d &quot;/opt/nginx-1.4.1&quot; ] || { ins_nginx; ini_nginx; ini_nginx_site; }

exit 0
</code></pre>
<h3 id="libtrapsh">脚本lib.trap.sh</h3>
<pre><code class="language-bash">lib_name='trap'
lib_version=20121026

stderr_log=&quot;/dev/shm/stderr.log&quot;

#
# TO BE SOURCED ONLY ONCE:
#
###~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##

if test &quot;${g_libs[$lib_name]+_}&quot;; then
    return 0
else
    if test ${#g_libs[@]} == 0; then
        declare -A g_libs
    fi
    g_libs[$lib_name]=$lib_version
fi


#
# MAIN CODE:
#
###~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##

set -o pipefail  # trace ERR through pipes
set -o errtrace  # trace ERR through 'time command' and other functions
set -o nounset   ## set -u : exit the script if you try to use an uninitialised variable
set -o errexit   ## set -e : exit the script if any statement returns a non-true return value

exec 2&gt;&quot;$stderr_log&quot;


###~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##
#
# FUNCTION: EXIT_HANDLER
#
###~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##

function exit_handler ()
{
    local error_code=&quot;$?&quot;

    test $error_code == 0 &amp;&amp; return;

    #
    # LOCAL VARIABLES:
    # ------------------------------------------------------------------
    #
    local i=0
    local regex=''
    local mem=''

    local error_file=''
    local error_lineno=''
    local error_message='unknown'

    local lineno=''


    #
    # PRINT THE HEADER:
    # ------------------------------------------------------------------
    #
    # Color the output if it's an interactive terminal
    test -t 1 &amp;&amp; tput bold; tput setf 4                                 ## red bold
    echo -e &quot;\n(!) EXIT HANDLER:\n&quot;


    #
    # GETTING LAST ERROR OCCURRED:
    # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

    #
    # Read last file from the error log
    # ------------------------------------------------------------------
    #
    if test -f &quot;$stderr_log&quot;
        then
            stderr=$( tail -n 1 &quot;$stderr_log&quot; )
            rm &quot;$stderr_log&quot;
    fi

    #
    # Managing the line to extract information:
    # ------------------------------------------------------------------
    #

    if test -n &quot;$stderr&quot;
        then
            # Exploding stderr on :
            mem=&quot;$IFS&quot;
            local shrunk_stderr=$( echo &quot;$stderr&quot; | sed 's/\: /\:/g' )
            IFS=':'
            local stderr_parts=( $shrunk_stderr )
            IFS=&quot;$mem&quot;

            # Storing information on the error
            error_file=&quot;${stderr_parts[0]}&quot;
            error_lineno=&quot;${stderr_parts[1]}&quot;
            error_message=&quot;&quot;

            for (( i = 3; i &lt;= ${#stderr_parts[@]}; i++ ))
                do
                    error_message=&quot;$error_message &quot;${stderr_parts[$i-1]}&quot;: &quot;
            done

            # Removing last ':' (colon character)
            error_message=&quot;${error_message%:*}&quot;

            # Trim
            error_message=&quot;$( echo &quot;$error_message&quot; | sed -e 's/^[ \t]*//' | sed -e 's/[ \t]*$//' )&quot;
    fi

    #
    # GETTING BACKTRACE:
    # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
    _backtrace=$( backtrace 2 )


    #
    # MANAGING THE OUTPUT:
    # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

    local lineno=&quot;&quot;
    regex='^([a-z]{1,}) ([0-9]{1,})$'

    if [[ $error_lineno =~ $regex ]]

        # The error line was found on the log
        # (e.g. type 'ff' without quotes wherever)
        # --------------------------------------------------------------
        then
            local row=&quot;${BASH_REMATCH[1]}&quot;
            lineno=&quot;${BASH_REMATCH[2]}&quot;

            echo -e &quot;FILE:\t\t${error_file}&quot;
            echo -e &quot;${row^^}:\t\t${lineno}\n&quot;

            echo -e &quot;ERROR CODE:\t${error_code}&quot;
            test -t 1 &amp;&amp; tput setf 6                                    ## white yellow
            echo -e &quot;ERROR MESSAGE:\n$error_message&quot;


        else
            regex=&quot;^${error_file}\$|^${error_file}\s+|\s+${error_file}\s+|\s+${error_file}\$&quot;
            if [[ &quot;$_backtrace&quot; =~ $regex ]]

                # The file was found on the log but not the error line
                # (could not reproduce this case so far)
                # ------------------------------------------------------
                then
                    echo -e &quot;FILE:\t\t$error_file&quot;
                    echo -e &quot;ROW:\t\tunknown\n&quot;

                    echo -e &quot;ERROR CODE:\t${error_code}&quot;
                    test -t 1 &amp;&amp; tput setf 6                            ## white yellow
                    echo -e &quot;ERROR MESSAGE:\n${stderr}&quot;

                # Neither the error line nor the error file was found on the log
                # (e.g. type 'cp ffd fdf' without quotes wherever)
                # ------------------------------------------------------
                else
                    #
                    # The error file is the first on backtrace list:

                    # Exploding backtrace on newlines
                    mem=$IFS
                    IFS='
                    '
                    #
                    # Substring: I keep only the carriage return
                    # (others needed only for tabbing purpose)
                    IFS=${IFS:0:1}
                    local lines=( $_backtrace )

                    IFS=$mem

                    error_file=&quot;&quot;

                    if test -n &quot;${lines[1]}&quot;
                        then
                            array=( ${lines[1]} )

                            for (( i=2; i&lt;${#array[@]}; i++ ))
                                do
                                    error_file=&quot;$error_file ${array[$i]}&quot;
                            done

                            # Trim
                            error_file=&quot;$( echo &quot;$error_file&quot; | sed -e 's/^[ \t]*//' | sed -e 's/[ \t]*$//' )&quot;
                    fi

                    echo -e &quot;FILE:\t\t$error_file&quot;
                    echo -e &quot;ROW:\t\tunknown\n&quot;

                    echo -e &quot;ERROR CODE:\t${error_code}&quot;
                    test -t 1 &amp;&amp; tput setf 6                            ## white yellow
                    if test -n &quot;${stderr}&quot;
                        then
                            echo -e &quot;ERROR MESSAGE:\n${stderr}&quot;
                        else
                            echo -e &quot;ERROR MESSAGE:\n${error_message}&quot;
                    fi
            fi
    fi

    #
    # PRINTING THE BACKTRACE:
    # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

    test -t 1 &amp;&amp; tput setf 7                                            ## white bold
    echo -e &quot;\n$_backtrace\n&quot;

    #
    # EXITING:
    # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

    test -t 1 &amp;&amp; tput setf 4                                            ## red bold
    echo &quot;Exiting!&quot;

    test -t 1 &amp;&amp; tput sgr0 # Reset terminal

    exit &quot;$error_code&quot;
}
trap exit_handler EXIT                                                  # ! ! ! TRAP EXIT ! ! !
trap exit ERR                                                           # ! ! ! TRAP ERR ! ! !


###~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##
#
# FUNCTION: BACKTRACE
#
###~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##

function backtrace
{
    local _start_from_=0

    local params=( &quot;$@&quot; )
    if (( &quot;${#params[@]}&quot; &gt;= &quot;1&quot; ))
        then
            _start_from_=&quot;$1&quot;
    fi

    local i=0
    local first=false
    while caller $i &gt; /dev/null
    do
        if test -n &quot;$_start_from_&quot; &amp;&amp; (( &quot;$i&quot; + 1   &gt;= &quot;$_start_from_&quot; ))
            then
                if test &quot;$first&quot; == false
                    then
                        echo &quot;BACKTRACE IS:&quot;
                        first=true
                fi
                caller $i
        fi
        let &quot;i=i+1&quot;
    done
}
return 0
</code></pre>
                <div>

            </div>

        </div>
    </div>
</main>




<script src="../static/js/bootstrap.min.js"></script>
<script src="../static/js/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
<script>
    (() => {
        'use strict'

        document.querySelectorAll("#article-nav a.art-link").forEach(element => {
            let url = element.getAttribute("href")
            // console.log(url, url.endsWith("centos/centos-install-lamp.html"))
            if (url.endsWith("centos/centos-install-lamp.html")) {
                // element.classList.add("active")
                element.style.color = "#f97316"
            }
        })
    })()
</script>
</body>
</html>
